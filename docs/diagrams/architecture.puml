@startuml
!theme plain
skinparam componentStyle uml2

package "Data Sources" {
    [Git Repository] as Git
    [Source Code] as Source
}

package "Codefang Platform" {
    component "uast (Binary)" as UASTBin {
        [Language Parsers (Tree-sitter)] as Parsers
        [UAST Converter] as Converter
    }

    component "codefang (Binary)" as MainBin {
        portin CLI
        
        package "History Mining" {
            [Go-Git Reader] as GoGit
            [Burndown Analysis] as Burndown
            [Coupling Analysis] as Coupling
        }

        package "Static Analysis" {
            [Analyzer Factory] as Factory
            [Visitor Dispatcher] as Dispatcher
            
            frame "Analyzers" {
                [Complexity]
                [Cohesion]
                [Imports]
                [...others...]
            }
        }
        
        database "In-Memory Structures" {
            [Red-Black Trees (Pooled)] as RBT
            [Symbol Tables] as SymTab
            [Dependency Graph] as Graph
        }
    }
}

package "Consumers" {
    [CLI Output (JSON/Table)] as Output
    [AI Agents (MCP)] as AI
}

Git --> GoGit
Source --> Parsers
Parsers -> Converter : Generates AST
Converter -> Dispatcher : UAST Nodes

GoGit --> RBT : Stores Timelines
GoGit --> SymTab : Interns Paths

Dispatcher --> Factory : Orchestrates
Factory --> Complexity
Factory --> Cohesion
Factory --> Imports

Analyzers --> Output : Reports
Analyzers --> AI : Context

@enduml
