suite: assignment-call-binaryop
name: go-assignment-call-binaryop

parse_cases:
  - name: assignment_call_binaryop
    input: |
      func h(a, b int) int {
          c := a + b
          d := -a
          e := f(a)
          return c + d + e
      }
    output:
      type: "File"
      roles: []
      children:
        - type: "Function"
          token: |-
            func h(a, b int) int {
                c := a + b
                d := -a
                e := f(a)
                return c + d + e
            }
          props:
            name: "h"
          roles: ["Function", "Declaration"]
          children:
            - type: "Identifier"
              token: "h"
              roles: ["Name"]
            - type: "Parameter"
              token: "(a, b int)"
              roles: ["Parameter"]
              children:
                - type: "Parameter"
                  props:
                    name: "a"
                  roles: ["Parameter"]
                  children:
                    - type: "Identifier"
                      token: "a"
                      roles: ["Name"]
                    - type: "Identifier"
                      token: "b"
                      roles: ["Name"]
                    - type: "Identifier"
                      token: "int"
                      roles: ["Name", "Type"]
            - type: "Identifier"
              token: "int"
              roles: ["Name", "Type"]
            - type: "Block"
              token: |-
                {
                    c := a + b
                    d := -a
                    e := f(a)
                    return c + d + e
                }
              roles: ["Body"]
              children:
                - type: "Variable"
                  token: "c := a + b"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "c"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "BinaryOp"
                          roles: ["Operator"]
                          children:
                            - type: "Identifier"
                              token: "a"
                              roles: ["Name"]
                            - type: "Identifier"
                              token: "b"
                              roles: ["Name"]
                - type: "Variable"
                  token: "d := -a"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "d"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "UnaryOp"
                          token: "-a"
                          roles: ["Operator"]
                          children:
                            - type: "Identifier"
                              token: "a"
                              roles: ["Name"]
                - type: "Variable"
                  token: "e := f(a)"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "e"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "Call"
                          token: "f(a)"
                          roles: ["Call"]
                          children:
                            - type: "Identifier"
                              token: "f"
                              roles: ["Name"]
                            - type: "List"
                              token: "(a)"
                              roles: []
                              children:
                                - type: "Identifier"
                                  token: "a"
                                  roles: ["Name"]
                - type: "Return"
                  token: "return c + d + e"
                  roles: ["Return"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "BinaryOp"
                          roles: ["Operator"]
                          children:
                            - type: "BinaryOp"
                              roles: ["Operator"]
                              children:
                                - type: "Identifier"
                                  token: "c"
                                  roles: ["Name"]
                                - type: "Identifier"
                                  token: "d"
                                  roles: ["Name"]
                            - type: "Identifier"
                              token: "e"
                              roles: ["Name"]

query_cases:
  - name: find_binary_ops
    input: |
      func f() { x := a + b * c }
    query: 'rfilter(.type == "BinaryOp") |> map(.type)'
    output:
      results:
        - "BinaryOp"
        - "BinaryOp"

  - name: find_calls
    input: |
      func f() { x := foo(1); y := bar(2) }
    query: 'rfilter(.type == "Call") |> map(.type)'
    output:
      results:
        - "Call"
        - "Call"
