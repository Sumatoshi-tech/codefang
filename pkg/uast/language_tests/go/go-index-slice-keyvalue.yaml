suite: index-slice-keyvalue
name: go-index-slice-keyvalue

parse_cases:
  - name: index_slice_keyvalue
    input: |
      func f() {
          arr := []int{1, 2, 3}
          x := arr[0]
          y := arr[1:2]
          m := map[string]int{"a": 1}
      }
    output:
      type: "File"
      roles: []
      children:
        - type: "Function"
          token: |-
            func f() {
                arr := []int{1, 2, 3}
                x := arr[0]
                y := arr[1:2]
                m := map[string]int{"a": 1}
            }
          props:
            name: "f"
          roles: ["Function", "Declaration"]
          children:
            - type: "Identifier"
              token: "f"
              roles: ["Name"]
            - type: "Parameter"
              token: "()"
              roles: ["Parameter"]
            - type: "Block"
              token: |-
                {
                    arr := []int{1, 2, 3}
                    x := arr[0]
                    y := arr[1:2]
                    m := map[string]int{"a": 1}
                }
              roles: ["Body"]
              children:
                - type: "Variable"
                  token: "arr := []int{1, 2, 3}"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "arr"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "Literal"
                          roles: ["Literal"]
                          children:
                            - type: "Slice"
                              token: "[]int"
                              roles: []
                              children:
                                - type: "Identifier"
                                  token: "int"
                                  roles: ["Name", "Type"]
                            - type: "Literal"
                              roles: ["Literal"]
                              children:
                                - type: "Literal"
                                  token: "1"
                                  roles: ["Literal"]
                                  children:
                                    - type: "Literal"
                                      roles: ["Literal"]
                                - type: "Literal"
                                  token: "2"
                                  roles: ["Literal"]
                                  children:
                                    - type: "Literal"
                                      roles: ["Literal"]
                                - type: "Literal"
                                  token: "3"
                                  roles: ["Literal"]
                                  children:
                                    - type: "Literal"
                                      roles: ["Literal"]
                - type: "Variable"
                  token: "x := arr[0]"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "x"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "Index"
                          roles: ["Index"]
                          children:
                            - type: "Identifier"
                              token: "arr"
                              roles: ["Name"]
                            - type: "Literal"
                              roles: ["Literal"]
                - type: "Variable"
                  token: "y := arr[1:2]"
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "y"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "Slice"
                          roles: []
                          children:
                            - type: "Identifier"
                              token: "arr"
                              roles: ["Name"]
                            - type: "Literal"
                              roles: ["Literal"]
                            - type: "Literal"
                              roles: ["Literal"]
                - type: "Variable"
                  token: 'm := map[string]int{"a": 1}'
                  roles: ["Variable", "Declaration"]
                  children:
                    - type: "List"
                      roles: []
                      children:
                        - type: "Identifier"
                          token: "m"
                          roles: ["Name"]
                    - type: "List"
                      roles: []
                      children:
                        - type: "Literal"
                          roles: ["Literal"]
                          children:
                            - type: "Synthetic"
                              token: "map[string]int"
                              roles: []
                              children:
                                - type: "Identifier"
                                  token: "string"
                                  roles: ["Name", "Type"]
                                - type: "Identifier"
                                  token: "int"
                                  roles: ["Name", "Type"]
                            - type: "Literal"
                              roles: ["Literal"]
                              children:
                                - type: "KeyValue"
                                  token: '"a": 1'
                                  roles: ["Key"]
                                  children:
                                    - type: "Literal"
                                      token: '"a"'
                                      roles: ["Literal"]
                                      children:
                                        - type: "Literal"
                                          roles: ["Literal"]
                                          children:
                                            - type: "Literal"
                                              roles: ["Literal"]
                                    - type: "Literal"
                                      token: "1"
                                      roles: ["Literal"]
                                      children:
                                        - type: "Literal"
                                          roles: ["Literal"]

query_cases:
  - name: find_index
    input: |
      func f() { x := arr[0]; y := arr[1] }
    query: 'rfilter(.type == "Index") |> map(.type)'
    output:
      results:
        - "Index"
        - "Index"

  - name: find_keyvalue
    input: |
      func f() { m := map[string]int{"a": 1, "b": 2} }
    query: 'rfilter(.type == "KeyValue") |> map(.type)'
    output:
      results:
        - "KeyValue"
        - "KeyValue"
